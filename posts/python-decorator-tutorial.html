<!DOCTYPE html>
<html lang="en">
<head>
          <title>Ha.Minh's Blog</title>
        <meta charset="utf-8" />
        <link href="http://minhhh.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Ha.Minh's Blog Full Atom Feed" />
        <link href="http://minhhh.github.io/feeds/programming.atom.xml" type="application/atom+xml" rel="alternate" title="Ha.Minh's Blog Categories Atom Feed" />



    <meta name="tags" contents="python" />
    <meta name="tags" contents="decorator" />

</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="http://minhhh.github.io/">Ha.Minh's Blog <strong>Software development and other stuff</strong></a></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
            <li><a href="http://minhhh.github.io/pages/about">About</a></li>
            <li><a href="http://minhhh.github.io/pages/projects">Projects</a></li>
        </ul></nav><!-- /#menu -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://minhhh.github.io/posts/python-decorator-tutorial" rel="bookmark"
         title="Permalink to Python decorator tutorial">Python decorator tutorial</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2014-10-05T00:00:00">
      Sun 05 October 2014
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="http://minhhh.github.io/author/haminh.html">Ha.Minh</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p><div>
    <style type = "text/css" scoped>
.git-content div {
    padding: 0;
    margin: 0;
}

.git-content .git-file {
    border: 1px solid #DEDEDE;
    margin-bottom: 1em;
}

.git-content .git-file .git-meta {
    background-color: #EAEAEA;
    color: #666666;
    font-size: 85%;
    overflow: hidden;
    padding: 0.5em;
}

.git-content .git-file .git-meta a {
    color: #336699;
}

.git-content .git-file .git-meta a:visited {
    color: #773377;
}

.git-content .git-file {
    background-color: #F8F8FF;
    border-bottom: 1px solid #DDDDDD;
    font-size: 100%;
    overflow: auto;
    word-wrap: normal;
}

.git-content .git-file pre {
    background: none repeat scroll 0 0 transparent !important;
    border: medium none !important;
    margin: 0 !important;
    padding: 0 !important;
}
    </style>
    <div class="git-content">
        <div class="git-file">
            <div class="file">
 <div class="readme blob instapaper_body" id="readme">
  <article class="markdown-body entry-content" itemprop="text">
   <h1>
    <a aria-hidden="true" class="anchor" href="#python-decorator-tutorial" id="user-content-python-decorator-tutorial">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd">
      </path>
     </svg>
    </a>
    PYTHON DECORATOR TUTORIAL
   </h1>
   <p>
    Decorators are a powerful tool for getting rid of code duplication, aka following DRY principle. It also helps with standardization of code in a project without forcing developers to remember predefined snippets or patters. In this tutorial, we'll discover how to create and use them.
   </p>
   <p>
    Another important point to note is I'm aiming for practical value of the decorators so there will be no
    <code>
     foo
    </code>
    ,
    <code>
     bar
    </code>
    examples, all examples must solve real world problem and/or taken from good source.
   </p>
   <h2>
    <a aria-hidden="true" class="anchor" href="#first-level" id="user-content-first-level">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd">
      </path>
     </svg>
    </a>
    First level
   </h2>
   <p>
    We all know memoization and probably implement it as a function that takes an arbitrary function and return a memoized function:
   </p>
   <div class="highlight highlight-source-python">
    <pre>    memoized_factorial <span class="pl-k">=</span> construct_memoize(factorial)</pre>
   </div>
   <p>
    <br/>
   </p>
   <p>
    This is extremely cumbersome if
    <code>
     factorial
    </code>
    is a method of some class because then we have to use temporary variable to store the memoized function and somehow reassign it to the method. We want some way to elegantly do all the manual things to make a memoized version of a function, this is where
    <code>
     decorator
    </code>
    comes in.
   </p>
   <p>
    In its simplest form, a decorator is a function that takes the original function and returns a
    <code>
     decorated function
    </code>
   </p>
   <div class="highlight highlight-source-python">
    <pre>    cache_obj <span class="pl-k">=</span> {}

    <span class="pl-k">def</span> <span class="pl-en">cache</span>(<span class="pl-smi">func</span>):
        <span class="pl-k">def</span> <span class="pl-en">inner</span>(<span class="pl-k">*</span><span class="pl-smi">args</span>, <span class="pl-k">**</span><span class="pl-smi">kwargs</span>):
            <span class="pl-k">global</span> cache_obj
            key <span class="pl-k">=</span> <span class="pl-c1">str</span>(args) <span class="pl-k">+</span> <span class="pl-c1">str</span>(kwargs)
            <span class="pl-k">if</span> key <span class="pl-k">not</span> <span class="pl-k">in</span> cache_obj:
                cache_obj[key] <span class="pl-k">=</span> func(<span class="pl-k">*</span>args, <span class="pl-k">**</span>kwargs)
            <span class="pl-k">else</span>:
                <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">"</span>Get from cache <span class="pl-c1">{}</span><span class="pl-pds">"</span></span>.format(key)
            <span class="pl-k">return</span> cache_obj[key]
        <span class="pl-k">return</span> inner

    <span class="pl-en">@cache</span>
    <span class="pl-k">def</span> <span class="pl-c1">sum</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>):
        <span class="pl-s"><span class="pl-pds">"""</span>Sum 2 numbers</span>
<span class="pl-s">        <span class="pl-pds">"""</span></span>
        <span class="pl-k">return</span> a <span class="pl-k">+</span> b</pre>
   </div>
   <p>
    <br/>
   </p>
   <p>
    The
    <code>
     @
    </code>
    is a special syntax that applies the decorator function to the underneath function or class. Here,
    <code>
     cache(func)
    </code>
    is called, passing original
    <code>
     func
    </code>
    to the decorator, then replace
    <code>
     func
    </code>
    with whatever function is returned from
    <code>
     cache(func)
    </code>
    .
   </p>
   <p>
    Using global cache object
    <code>
     cache_obj
    </code>
    is not a great idea, because different functions can have the same arguments, then your cache is overwritten. It's better to assign the cache object directly to the original function
   </p>
   <div class="highlight highlight-source-python">
    <pre>    <span class="pl-k">def</span> <span class="pl-en">memoize_2</span>(<span class="pl-smi">func</span>):
        <span class="pl-k">if</span> <span class="pl-k">not</span> <span class="pl-c1">hasattr</span>(func, <span class="pl-s"><span class="pl-pds">'</span>cache<span class="pl-pds">'</span></span>):
            func.cache <span class="pl-k">=</span> {}
        <span class="pl-k">def</span> <span class="pl-en">inner</span>(<span class="pl-k">*</span><span class="pl-smi">args</span>, <span class="pl-k">**</span><span class="pl-smi">kwargs</span>):
            key <span class="pl-k">=</span> <span class="pl-c1">str</span>(args) <span class="pl-k">+</span> <span class="pl-c1">str</span>(kwargs)
            <span class="pl-k">if</span> key <span class="pl-k">not</span> <span class="pl-k">in</span> func.cache:
                func.cache[key] <span class="pl-k">=</span> func(<span class="pl-k">*</span>args, <span class="pl-k">**</span>kwargs)
            <span class="pl-k">else</span>:
                <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">"</span>Get from cache <span class="pl-c1">{}</span><span class="pl-pds">"</span></span>.format(key)
            <span class="pl-k">return</span> func.cache[key]
        <span class="pl-k">return</span> inner

    <span class="pl-en">@memoize_2</span>
    <span class="pl-k">def</span> <span class="pl-en">multiply</span>(<span class="pl-smi">a</span>, <span class="pl-smi">b</span>):
        <span class="pl-s"><span class="pl-pds">"""</span>Multiply 2 numbers</span>
<span class="pl-s">        <span class="pl-pds">"""</span></span>
        <span class="pl-k">return</span> a <span class="pl-k">*</span> b

    multiply(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>)
    multiply(<span class="pl-c1">1</span>,<span class="pl-c1">2</span>)</pre>
   </div>
   <p>
    <br/>
   </p>
   <p>
    This decorator is nice, but in practice nobody does this, and it's too bad that a lot of tutorials keep giving these non-working examples. The reason is the new decorated function lose all its original information such as name, docstring, module name and so on.
   </p>
   <div class="highlight highlight-source-python">
    <pre>    <span class="pl-c1">print</span> multiply.<span class="pl-c1">__doc__</span> <span class="pl-c"><span class="pl-c">#</span> None</span></pre>
   </div>
   <p>
    <br/>
   </p>
   <p>
    To keep these information, we use
    <code>
     functools.wrapper
    </code>
   </p>
   <div class="highlight highlight-source-python">
    <pre>    <span class="pl-k">import</span> functools
    <span class="pl-k">def</span> <span class="pl-en">memoize</span>(<span class="pl-smi">func</span>):
        <span class="pl-en">@functools.wraps</span>(func)
        <span class="pl-k">def</span> <span class="pl-en">inner</span>(<span class="pl-k">*</span><span class="pl-smi">args</span>, <span class="pl-k">**</span><span class="pl-smi">kwargs</span>):
            key <span class="pl-k">=</span> <span class="pl-c1">str</span>(args) <span class="pl-k">+</span> <span class="pl-c1">str</span>(kwargs)
            <span class="pl-k">if</span> <span class="pl-k">not</span> <span class="pl-c1">hasattr</span>(func, <span class="pl-s"><span class="pl-pds">'</span>cache<span class="pl-pds">'</span></span>):
                func.cache <span class="pl-k">=</span> {}
            <span class="pl-k">if</span> key <span class="pl-k">not</span> <span class="pl-k">in</span> func.cache:
                func.cache[key] <span class="pl-k">=</span> func(<span class="pl-k">*</span>args, <span class="pl-k">**</span>kwargs)
            <span class="pl-k">else</span>:
                <span class="pl-c1">print</span> <span class="pl-s"><span class="pl-pds">"</span>Get from cache <span class="pl-c1">{}</span><span class="pl-pds">"</span></span>.format(key)
            <span class="pl-k">return</span> func.cache[key]
        <span class="pl-k">return</span> inner

    <span class="pl-c1">print</span> multiply.<span class="pl-c1">__doc__</span> <span class="pl-c"><span class="pl-c">#</span> Multiply 2 numbers</span></pre>
   </div>
   <p>
    <br/>
   </p>
   <p>
    Now the decorated function also retain important information from the original functions, that's neat!
   </p>
   <h2>
    <a aria-hidden="true" class="anchor" href="#higher-level" id="user-content-higher-level">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd">
      </path>
     </svg>
    </a>
    Higher level
   </h2>
   <p>
    The
    <code>
     memoize
    </code>
    decorator doesn't need any customization, but there are a lot of pattern that requires some kind of customization. For instance, we want to apply a retry pattern to a function that follows special protocol. Obviously, we have to specify the number of retries, the delay between retry, and maybe a backoff factor to scale up the delay between failed attempts. This is how we do it:
   </p>
   <div class="highlight highlight-source-python">
    <pre>    <span class="pl-k">import</span> time, math

    <span class="pl-k">def</span> <span class="pl-en">retry</span>(<span class="pl-smi">tries</span>, <span class="pl-smi">delay</span><span class="pl-k">=</span><span class="pl-c1">3</span>, <span class="pl-smi">backoff</span><span class="pl-k">=</span><span class="pl-c1">2</span>):
        <span class="pl-s"><span class="pl-pds">'''</span>Retries a function or method until it returns True.</span>
<span class="pl-s">        delay sets the initial delay in seconds, and backoff sets the factor by which</span>
<span class="pl-s">        the delay should lengthen after each failure. backoff must be greater than 1,</span>
<span class="pl-s">        or else it isn't really a backoff. tries must be at least 0, and delay</span>
<span class="pl-s">        greater than 0.<span class="pl-pds">'''</span></span>

        <span class="pl-k">if</span> backoff <span class="pl-k">&lt;=</span> <span class="pl-c1">1</span>:
            <span class="pl-k">raise</span> <span class="pl-c1">ValueError</span>(<span class="pl-s"><span class="pl-pds">"</span>backoff must be greater than 1<span class="pl-pds">"</span></span>)

        <span class="pl-k">if</span> tries <span class="pl-k">&lt;</span> <span class="pl-c1">0</span>:
            <span class="pl-k">raise</span> <span class="pl-c1">ValueError</span>(<span class="pl-s"><span class="pl-pds">"</span>tries must be 0 or greater<span class="pl-pds">"</span></span>)

        <span class="pl-k">if</span> delay <span class="pl-k">&lt;=</span> <span class="pl-c1">0</span>:
            <span class="pl-k">raise</span> <span class="pl-c1">ValueError</span>(<span class="pl-s"><span class="pl-pds">"</span>delay must be greater than 0<span class="pl-pds">"</span></span>)

        <span class="pl-k">def</span> <span class="pl-en">deco_retry</span>(<span class="pl-smi">f</span>):
            <span class="pl-k">def</span> <span class="pl-en">f_retry</span>(<span class="pl-k">*</span><span class="pl-smi">args</span>, <span class="pl-k">**</span><span class="pl-smi">kwargs</span>):
                mtries, mdelay <span class="pl-k">=</span> tries, delay

                rv <span class="pl-k">=</span> f(<span class="pl-k">*</span>args, <span class="pl-k">**</span>kwargs)
                <span class="pl-k">while</span> mtries <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>:
                    <span class="pl-k">if</span> rv <span class="pl-k">is</span> <span class="pl-c1">True</span>:
                        <span class="pl-k">return</span> <span class="pl-c1">True</span>

                    mtries <span class="pl-k">-=</span> <span class="pl-c1">1</span>
                    time.sleep(mdelay)
                    mdelay <span class="pl-k">*=</span> backoff

                    rv <span class="pl-k">=</span> f(<span class="pl-k">*</span>args, <span class="pl-k">**</span>kwargs)

                <span class="pl-k">return</span> <span class="pl-c1">False</span>
            <span class="pl-k">return</span> f_retry
        <span class="pl-k">return</span> deco_retry

    <span class="pl-en">@retry</span>(<span class="pl-c1">1</span>, <span class="pl-v">delay</span><span class="pl-k">=</span><span class="pl-c1">1</span>, <span class="pl-v">backoff</span><span class="pl-k">=</span><span class="pl-c1">2</span>)
    <span class="pl-k">def</span> <span class="pl-en">get_data</span>():
        <span class="pl-k">return</span> <span class="pl-c1">False</span></pre>
   </div>
   <p>
    <br/>
   </p>
   <p>
    Here, we define
    <code>
     retry
    </code>
    as a function that returns a
    <code>
     decorator
    </code>
    which will do the actual decoration of our original function with the parameters provided by
    <code>
     retry
    </code>
    . We consider that
    <code>
     retry(1, delay=1, backoff=2)
    </code>
    is called first, returning a function, then the decorator syntax
    <code>
     @
    </code>
    is applied. This is just an addition of another layer on the decoration stack. In theory, you can have unlimited number of nested layer, but in practice, most of the time you only use 2.
   </p>
   <h2>
    <a aria-hidden="true" class="anchor" href="#decorator-class" id="user-content-decorator-class">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd">
      </path>
     </svg>
    </a>
    Decorator class
   </h2>
   <p>
    Using function as decorators is straight forward, and for storing persistent information we use closures over temporary variables. It'd be nice if the persistent information are class members.
   </p>
   <div class="highlight highlight-source-python">
    <pre>    <span class="pl-k">import</span> collections
    <span class="pl-k">class</span> <span class="pl-en">memoized</span>(<span class="pl-c1">object</span>):
        <span class="pl-s"><span class="pl-pds">'''</span>Decorator. Caches a function's return value each time it is called.</span>
<span class="pl-s">        If called later with the same arguments, the cached value is returned</span>
<span class="pl-s">        (not reevaluated).</span>
<span class="pl-s">        <span class="pl-pds">'''</span></span>
        <span class="pl-k">def</span> <span class="pl-c1">__init__</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">func</span>):
            <span class="pl-c1">self</span>.func <span class="pl-k">=</span> func
            <span class="pl-c1">self</span>.<span class="pl-c1">__doc__</span> <span class="pl-k">=</span> func.<span class="pl-c1">__doc__</span>
            <span class="pl-c1">self</span>.cache <span class="pl-k">=</span> {}
        <span class="pl-k">def</span> <span class="pl-c1">__call__</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-k">*</span><span class="pl-smi">args</span>, <span class="pl-k">**</span><span class="pl-smi">kwargs</span>):
            <span class="pl-k">if</span> <span class="pl-k">not</span> <span class="pl-c1">isinstance</span>(args, collections.Hashable):
                <span class="pl-c"><span class="pl-c">#</span> uncacheable. a list, for instance.</span>
                <span class="pl-c"><span class="pl-c">#</span> better to not cache than blow up.</span>
                <span class="pl-k">return</span> <span class="pl-c1">self</span>.func(<span class="pl-k">*</span>args, <span class="pl-k">**</span>kwargs)
            <span class="pl-k">if</span> args <span class="pl-k">in</span> <span class="pl-c1">self</span>.cache:
                <span class="pl-k">return</span> <span class="pl-c1">self</span>.cache[args]
            <span class="pl-k">else</span>:
                value <span class="pl-k">=</span> <span class="pl-c1">self</span>.func(<span class="pl-k">*</span>args, <span class="pl-k">**</span>kwargs)
                <span class="pl-c1">self</span>.cache[args] <span class="pl-k">=</span> value
                <span class="pl-k">return</span> value
        <span class="pl-k">def</span> <span class="pl-c1">__repr__</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>):
            <span class="pl-s"><span class="pl-pds">'''</span>Return the function's docstring.<span class="pl-pds">'''</span></span>
            <span class="pl-k">return</span> <span class="pl-c1">self</span>.func.<span class="pl-c1">__doc__</span>
        <span class="pl-k">def</span> <span class="pl-c1">__get__</span>(<span class="pl-smi"><span class="pl-smi">self</span></span>, <span class="pl-smi">obj</span>, <span class="pl-smi">objtype</span>):
            <span class="pl-s"><span class="pl-pds">'''</span>Support instance methods.<span class="pl-pds">'''</span></span>
            <span class="pl-k">return</span> functools.partial(<span class="pl-c1">self</span>.<span class="pl-c1">__call__</span>, obj)</pre>
   </div>
   <p>
    <br/>
   </p>
   <p>
    Here, the decorator is an object of class
    <code>
     memoized
    </code>
    and you can store all sort of information like you would a normal object.
   </p>
   <h2>
    <a aria-hidden="true" class="anchor" href="#class-decorator" id="user-content-class-decorator">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd">
      </path>
     </svg>
    </a>
    Class decorator
   </h2>
   <p>
    Up to now we're working with function decorator, what if we want to operate at class level? It's actually quite simple, we only have to define a function that takes a class instead of a function as the parameter.
   </p>
   <p>
    Let's have a look at
    <a href="https://hg.python.org/cpython/file/8e838598eed1/Lib/functools.py">
     functool.total_ordering
    </a>
    . This decorator makes it so that you only have to define one of the four functions
    <code>
     __lt__
    </code>
    ,
    <code>
     __le__
    </code>
    ,
    <code>
     __gt__
    </code>
    ,
    <code>
     __ge__
    </code>
    , and the other three will be defined based on the provided function.
   </p>
   <div class="highlight highlight-source-python">
    <pre>    <span class="pl-k">def</span> <span class="pl-en">total_ordering</span>(<span class="pl-smi"><span class="pl-smi">cls</span></span>):
        <span class="pl-s"><span class="pl-pds">"""</span>Class decorator that fills in missing ordering methods<span class="pl-pds">"""</span></span>
        convert <span class="pl-k">=</span> {
            <span class="pl-s"><span class="pl-pds">'</span>__lt__<span class="pl-pds">'</span></span>: [(<span class="pl-s"><span class="pl-pds">'</span>__gt__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-k">not</span> (<span class="pl-c1">self</span> <span class="pl-k">&lt;</span> other <span class="pl-k">or</span> <span class="pl-c1">self</span> <span class="pl-k">==</span> other)),
                    (<span class="pl-s"><span class="pl-pds">'</span>__le__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-c1">self</span> <span class="pl-k">&lt;</span> other <span class="pl-k">or</span> <span class="pl-c1">self</span> <span class="pl-k">==</span> other),
                    (<span class="pl-s"><span class="pl-pds">'</span>__ge__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-k">not</span> <span class="pl-c1">self</span> <span class="pl-k">&lt;</span> other)],
            <span class="pl-s"><span class="pl-pds">'</span>__le__<span class="pl-pds">'</span></span>: [(<span class="pl-s"><span class="pl-pds">'</span>__ge__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-k">not</span> <span class="pl-c1">self</span> <span class="pl-k">&lt;=</span> other <span class="pl-k">or</span> <span class="pl-c1">self</span> <span class="pl-k">==</span> other),
                    (<span class="pl-s"><span class="pl-pds">'</span>__lt__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-c1">self</span> <span class="pl-k">&lt;=</span> other <span class="pl-k">and</span> <span class="pl-k">not</span> <span class="pl-c1">self</span> <span class="pl-k">==</span> other),
                    (<span class="pl-s"><span class="pl-pds">'</span>__gt__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-k">not</span> <span class="pl-c1">self</span> <span class="pl-k">&lt;=</span> other)],
            <span class="pl-s"><span class="pl-pds">'</span>__gt__<span class="pl-pds">'</span></span>: [(<span class="pl-s"><span class="pl-pds">'</span>__lt__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-k">not</span> (<span class="pl-c1">self</span> <span class="pl-k">&gt;</span> other <span class="pl-k">or</span> <span class="pl-c1">self</span> <span class="pl-k">==</span> other)),
                    (<span class="pl-s"><span class="pl-pds">'</span>__ge__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-c1">self</span> <span class="pl-k">&gt;</span> other <span class="pl-k">or</span> <span class="pl-c1">self</span> <span class="pl-k">==</span> other),
                    (<span class="pl-s"><span class="pl-pds">'</span>__le__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-k">not</span> <span class="pl-c1">self</span> <span class="pl-k">&gt;</span> other)],
            <span class="pl-s"><span class="pl-pds">'</span>__ge__<span class="pl-pds">'</span></span>: [(<span class="pl-s"><span class="pl-pds">'</span>__le__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: (<span class="pl-k">not</span> <span class="pl-c1">self</span> <span class="pl-k">&gt;=</span> other) <span class="pl-k">or</span> <span class="pl-c1">self</span> <span class="pl-k">==</span> other),
                    (<span class="pl-s"><span class="pl-pds">'</span>__gt__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-c1">self</span> <span class="pl-k">&gt;=</span> other <span class="pl-k">and</span> <span class="pl-k">not</span> <span class="pl-c1">self</span> <span class="pl-k">==</span> other),
                    (<span class="pl-s"><span class="pl-pds">'</span>__lt__<span class="pl-pds">'</span></span>, <span class="pl-k">lambda</span> <span class="pl-smi">self</span>, <span class="pl-smi">other</span>: <span class="pl-k">not</span> <span class="pl-c1">self</span> <span class="pl-k">&gt;=</span> other)]
        }
        <span class="pl-c"><span class="pl-c">#</span> Find user-defined comparisons (not those inherited from object).</span>
        roots <span class="pl-k">=</span> [op <span class="pl-k">for</span> op <span class="pl-k">in</span> convert <span class="pl-k">if</span> <span class="pl-c1">getattr</span>(<span class="pl-c1">cls</span>, op, <span class="pl-c1">None</span>) <span class="pl-k">is</span> <span class="pl-k">not</span> <span class="pl-c1">getattr</span>(<span class="pl-c1">object</span>, op, <span class="pl-c1">None</span>)]
        <span class="pl-k">if</span> <span class="pl-k">not</span> roots:
            <span class="pl-k">raise</span> <span class="pl-c1">ValueError</span>(<span class="pl-s"><span class="pl-pds">'</span>must define at least one ordering operation: &lt; &gt; &lt;= &gt;=<span class="pl-pds">'</span></span>)
        root <span class="pl-k">=</span> <span class="pl-c1">max</span>(roots)       <span class="pl-c"><span class="pl-c">#</span> prefer __lt__ to __le__ to __gt__ to __ge__</span>
        <span class="pl-k">for</span> opname, opfunc <span class="pl-k">in</span> convert[root]:
            <span class="pl-k">if</span> opname <span class="pl-k">not</span> <span class="pl-k">in</span> roots:
                opfunc.<span class="pl-c1">__name__</span> <span class="pl-k">=</span> opname
                opfunc.<span class="pl-c1">__doc__</span> <span class="pl-k">=</span> <span class="pl-c1">getattr</span>(<span class="pl-c1">int</span>, opname).<span class="pl-c1">__doc__</span>
                <span class="pl-c1">setattr</span>(<span class="pl-c1">cls</span>, opname, opfunc)
        <span class="pl-k">return</span> <span class="pl-c1">cls</span></pre>
   </div>
   <p>
    <br/>
   </p>
   <p>
    This code is pretty simple. It defines 3 other operators based on 2 operators:
    <code>
     __eq__
    </code>
    and one of the four functions
    <code>
     __lt__
    </code>
    ,
    <code>
     __le__
    </code>
    ,
    <code>
     __gt__
    </code>
    ,
    <code>
     __ge__
    </code>
    .
   </p>
   <h2>
    <a aria-hidden="true" class="anchor" href="#useful-decorators" id="user-content-useful-decorators">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd">
      </path>
     </svg>
    </a>
    Useful decorators
   </h2>
   <ul>
    <li>
     property - used to quickly create a field from appropriate getter, setter and deleter.
    </li>
   </ul>
   <h1>
    <a aria-hidden="true" class="anchor" href="#references" id="user-content-references">
     <svg aria-hidden="true" class="octicon octicon-link" height="16" version="1.1" viewbox="0 0 16 16" width="16">
      <path d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z" fill-rule="evenodd">
      </path>
     </svg>
    </a>
    REFERENCES
   </h1>
   <ul>
    <li>
     <a href="https://wiki.python.org/moin/PythonDecoratorLibrary" title="Python Decorator Library">
      Python Decorator Library
     </a>
    </li>
   </ul>
  </article>
 </div>
</div>

            <div class="git-meta">
                
                <span>Brought to you by <a href="https://github.com/minhhh/pelican-git">pelican_git</a>.</span>
                
                <span style="float: right; color: #369;"><a href="https://github.com/minhhh/wiki/blob/master/py_decorators.md">view original</a></span>
                <span style="float: right; margin-right: 8px;">
                    <a style="color: rgb(102, 102, 102);" href="https://github.com/minhhh/wiki/blob/master/py_decorators.md">py_decorators.md</a></span>
            </div>
        </div>
    </div>
</div></p>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>