<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="" />
    <meta name="author" content="Huy Minh Ha" />
    <meta name="generator" content="Pelican (VoidyBootstrap theme)" />

    <title>Unity singleton - Huy Minh Ha</title>

   
        <link rel="stylesheet"
              href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
              integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
              crossorigin="anonymous" />
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />


      <link rel="stylesheet" href="https://minhhh.github.io/theme/css/pygment.css" />
      <link rel="stylesheet" href="https://minhhh.github.io/theme/css/voidybootstrap.css" />

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="https://minhhh.github.io/favicon.ico" />
        <link href="https://minhhh.github.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Huy Minh Ha Atom Feed" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50796592-2', '');
  ga('send', 'pageview');

</script>
  </head>

  <body>
   
    <nav class="navbar navbar-default" role="navigation">
      <div class="container">
	   <div class="navbar-header">
		<button type="button" class="navbar-toggle" 
				data-toggle="collapse" data-target="#main-navbar-collapse">
		  <span class="sr-only">Toggle navigation</span>
		  <span class="icon-bar"></span>
		  <span class="icon-bar"></span>
		  <span class="icon-bar"></span>
		</button>
		<a class="navbar-brand" href="https://minhhh.github.io/" rel="home">
          <i class="fa fa-home fa-fw fa-lg"> </i> </a>
       </div>

      <div class="collapse navbar-collapse" id="main-navbar-collapse">
        <ul class="nav navbar-nav">
              <li>
                <a href="https://minhhh.github.io/pages/about">About</a>
              </li>
              <li>
                <a href="https://minhhh.github.io/pages/projects">Projects</a>
              </li>
            <li class="divider"></li>
            <li class="">
              <a href="https://minhhh.github.io/archives.html">Archives</a>
            </li>
          <li class="divider"></li>
            <li><a href="https://minhhh.github.io/feeds/all.atom.xml" 
                   type="application/atom+xml" rel="alternate">
                <i class="fa fa-rss fa-fw fa-lg"></i> </a></li>
        </ul> <!-- /nav -->
      </div> <!-- /navbar-collapse -->
	  </div> <!-- /container -->
    </nav> <!-- /navbar -->

	<div class="jumbotron" id="overview">
	  <div class="container">
		<h1><a href="https://minhhh.github.io/">Huy Minh Ha</a></h1>
		<p class="lead">Software development, Tech and other stuff</p>
	  </div>
	</div>

    <div class="container" id="main-container">
      <div class="row">
        <div class="col-md-9" id="content">
<article itemscope="itemscope" itemtype="http://schema.org/BlogPosting">
  <header class="article-header">
<abbr class="article-header-date">
  Thu 29 September 2016
</abbr> <h1>
  <a href="https://minhhh.github.io/posts/unity-singleton" rel="bookmark"
     title="Permalink to Unity singleton">
    Unity singleton
  </a>
</h1><div class="article-header-info">
  <p>
      Posted by <a href="https://minhhh.github.io/author/haminh.html">Ha.Minh</a>
    in 
    <a href="https://minhhh.github.io/category/unity.html">
      Unity</a>
    &nbsp;&nbsp;
  </p>
</div> <!-- /.article-header-info -->  </header>
  <div class="content-body" itemprop="text articleBody">
	<p>First of all, please remember that Singletons are generally not recommended due to various obvious disadvantages:</p>
<ul>
<li>Hard to reason about code</li>
<li>Encourage coupling</li>
<li>Potential concurrency issue</li>
</ul>
<p>However, in game development it's super useful to have singleton for many types of global system, including but not limited to:</p>
<ul>
<li>Sound system</li>
<li>Time manager</li>
<li>Localization</li>
<li>Tutorial</li>
<li>Login</li>
<li>Global Notifier</li>
</ul>
<p>In this article we will look at some options of Singleton implementation we have in Unity to see what problems they're trying to solve and what assumptions they made.</p>
<h2>Requirements</h2>
<p>Let's first review some requirements for a useful singleton system in Unity.</p>
<p><strong>Singleton class types</strong></p>
<ul>
<li>MonoBehavior based: These types of singletons extends MonoBehavior and shows themselves in the scene hierarchy so that you can look at their exposed members. Another reason is you want them to have an <code>Update</code> function to do something useful in it.</li>
<li>Non MonoBehavior based: Traditional singletons in any OO languages. These singletons don't need to be inspected in the scene nor do they need <code>Update</code>. We will not focus on these types of singletons.</li>
</ul>
<p><strong>Singleton lifecycle types</strong></p>
<ul>
<li>Has dependencies: These singletons depend on other system or singletons to exist before they can start</li>
<li>No dependencies: These singletons can be created anytime without waiting for any other entities.</li>
</ul>
<p><strong>Singleton configurability types</strong></p>
<ul>
<li>Has customized parameters: This is a bit overlap with <code>Has dependencies</code> singletons. These singletons might: 1. Depend on parameters provided by another system, such as the FileSystem to load certian parameters from disk. OR 2. Need customized parameters or linked prefab. They might be in a prefab themselves such as a LevelManager.</li>
<li>No customized parameters: These singletons behave the same all the time.</li>
</ul>
<h2>Solutions</h2>
<p>Fortunately there're already some solutions written in <a href="http://wiki.unity3d.com">unity3d</a> so we can review and improve them as we wish.</p>
<h3>AManagerClass</h3>
<p><a href="http://wiki.unity3d.com/index.php/AManagerClass">AManagerClass</a> is a standard implementation which supports MonoBehavior-based singletons. In the code, we refer to the singleton like this:</p>
<div class="codehilite"><pre><span></span>    <span class="n">AManager</span><span class="p">.</span><span class="n">instance</span><span class="p">.</span><span class="n">Foo</span> <span class="p">();</span>
</pre></div>


<p>The <code>instance</code> function implementation is as below:</p>
<div class="codehilite"><pre><span></span>    <span class="nv">public</span> <span class="nv">static</span> <span class="nv">AManager</span> <span class="nv">instance</span> {
        <span class="nv">get</span> {
            <span class="k">if</span> <span class="ss">(</span><span class="nv">s_Instance</span> <span class="o">==</span> <span class="nv">null</span><span class="ss">)</span> {
                <span class="o">//</span> <span class="nv">This</span> <span class="nv">is</span> <span class="nv">where</span> <span class="nv">the</span> <span class="nv">magic</span> <span class="nv">happens</span>.
                <span class="o">//</span>  <span class="nv">FindObjectOfType</span><span class="ss">(</span>...<span class="ss">)</span> <span class="nv">returns</span> <span class="nv">the</span> <span class="nv">first</span> <span class="nv">AManager</span> <span class="nv">object</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">scene</span>.
                <span class="nv">s_Instance</span> <span class="o">=</span>  <span class="nv">FindObjectOfType</span><span class="ss">(</span><span class="nv">typeof</span> <span class="ss">(</span><span class="nv">AManager</span><span class="ss">))</span> <span class="nv">as</span> <span class="nv">AManager</span><span class="c1">;</span>
            }

            <span class="o">//</span> <span class="k">If</span> <span class="nv">it</span> <span class="nv">is</span> <span class="nv">still</span> <span class="nv">null</span>, <span class="nv">create</span> <span class="nv">a</span> <span class="nv">new</span> <span class="nv">instance</span>
            <span class="k">if</span> <span class="ss">(</span><span class="nv">s_Instance</span> <span class="o">==</span> <span class="nv">null</span><span class="ss">)</span> {
                <span class="nv">GameObject</span> <span class="nv">obj</span> <span class="o">=</span> <span class="nv">new</span> <span class="nv">GameObject</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">AManager</span><span class="s2">&quot;</span><span class="ss">)</span><span class="c1">;</span>
                <span class="nv">s_Instance</span> <span class="o">=</span> <span class="nv">obj</span>.<span class="nv">AddComponent</span><span class="ss">(</span><span class="nv">typeof</span> <span class="ss">(</span><span class="nv">AManager</span><span class="ss">))</span> <span class="nv">as</span> <span class="nv">AManager</span><span class="c1">;</span>
                <span class="nv">Debug</span>.<span class="nv">Log</span> <span class="ss">(</span><span class="s2">&quot;</span><span class="s">Could not locate an AManager object. \ AManager was Generated Automaticly.</span><span class="s2">&quot;</span><span class="ss">)</span><span class="c1">;</span>
            }

            <span class="k">return</span> <span class="nv">s_Instance</span><span class="c1">;</span>
        }
    }
</pre></div>


<p>There are several problems with <code>AManager</code>:</p>
<ul>
<li>We have to duplicate it for all singleton class</li>
<li>It's slow due to the 2 checks</li>
</ul>
<p>Surely we can do better!</p>
<h3>AutoSingletonManager</h3>
<ul>
<li><a href="http://wiki.unity3d.com/index.php/AutoSingletonManager">AutoSingletonManager</a> solves the code duplication problem of <code>AManager</code></li>
</ul>
<p>Here's the main code</p>
<div class="codehilite"><pre><span></span><span class="nv">public</span> <span class="nv">abstract</span> <span class="nv">class</span> <span class="nv">AutoSingletonManager</span> : <span class="nv">MonoBehaviour</span> { }

<span class="nv">public</span> <span class="nv">abstract</span> <span class="nv">class</span> <span class="nv">AutoSingletonManager</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span> : <span class="nv">AutoSingletonManager</span> <span class="nv">where</span> <span class="nv">T</span> : <span class="nv">AutoSingletonManager</span>
{
    <span class="nv">private</span> <span class="nv">static</span> <span class="nv">bool</span> <span class="nv">Compare</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">(</span><span class="nv">T</span> <span class="nv">x</span>, <span class="nv">T</span> <span class="nv">y</span><span class="ss">)</span> <span class="nv">where</span> <span class="nv">T</span> : <span class="nv">class</span>
    {
        <span class="k">return</span> <span class="nv">x</span> <span class="o">==</span> <span class="nv">y</span><span class="c1">;</span>
    }

    #<span class="nv">region</span> <span class="nv">Singleton</span>

    <span class="nv">private</span> <span class="nv">static</span> <span class="nv">T</span> <span class="nv">_instance</span> <span class="o">=</span> <span class="nv">default</span><span class="ss">(</span><span class="nv">T</span><span class="ss">)</span><span class="c1">;</span>

    <span class="nv">public</span> <span class="nv">static</span> <span class="nv">T</span> <span class="nv">Instance</span>
    {
        <span class="nv">get</span>
        {
            <span class="k">if</span> <span class="ss">(</span><span class="o">!</span><span class="nv">Compare</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">(</span><span class="nv">default</span><span class="ss">(</span><span class="nv">T</span><span class="ss">)</span>, <span class="nv">_instance</span><span class="ss">))</span> <span class="k">return</span> <span class="nv">_instance</span><span class="c1">;</span>

            <span class="nv">InitInstance</span><span class="ss">(</span><span class="nv">true</span><span class="ss">)</span><span class="c1">;</span>
            <span class="k">return</span> <span class="nv">_instance</span><span class="c1">;</span>
        }
    }

    #<span class="nv">endregion</span>

    <span class="nv">public</span> <span class="nv">void</span> <span class="nv">Awake</span><span class="ss">()</span>
    {
        <span class="nv">InitInstance</span><span class="ss">(</span><span class="nv">false</span><span class="ss">)</span><span class="c1">;</span>
    }

    <span class="nv">public</span> <span class="nv">static</span> <span class="nv">void</span> <span class="nv">InitInstance</span><span class="ss">(</span><span class="nv">bool</span> <span class="nv">shouldInitManager</span><span class="ss">)</span>
    {
        <span class="nv">Type</span> <span class="nv">thisType</span> <span class="o">=</span> <span class="nv">typeof</span> <span class="ss">(</span><span class="nv">T</span><span class="ss">)</span><span class="c1">;</span>

        <span class="nv">_instance</span> <span class="o">=</span> <span class="nv">FindObjectOfType</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>

        <span class="k">if</span> <span class="ss">(</span><span class="nv">Compare</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">(</span><span class="nv">default</span><span class="ss">(</span><span class="nv">T</span><span class="ss">)</span>, <span class="nv">_instance</span><span class="ss">))</span>
        {
            <span class="nv">_instance</span> <span class="o">=</span> <span class="nv">new</span> <span class="nv">GameObject</span><span class="ss">(</span><span class="nv">thisType</span>.<span class="nv">Name</span><span class="ss">)</span>.<span class="nv">AddComponent</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
        }

        <span class="o">//</span><span class="nv">Won</span><span class="s1">&#39;</span><span class="s">t call InitManager from Awake</span>
        <span class="k">if</span> <span class="ss">(</span><span class="nv">shouldInitManager</span><span class="ss">)</span>
        {
            <span class="ss">(</span><span class="nv">_instance</span> <span class="nv">as</span> <span class="nv">AutoSingletonManager</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">)</span>.<span class="nv">InitManager</span><span class="ss">()</span><span class="c1">;</span>
        }
    }

    <span class="nv">public</span> <span class="nv">virtual</span> <span class="nv">void</span> <span class="nv">InitManager</span><span class="ss">()</span> { }
}
</pre></div>


<p>The code uses recursive generic definition. This allow us to reuse code by inheriting from the singleton class as well as from <code>MonoBehaviour</code>. Note that we don't have to make <code>AutoSingletonManager&lt;T&gt;</code> inherits from <code>AutoSingletonManager</code>, instead we can make it inherit from our own class which in turn inherits from MonoBehavior.</p>
<p>It supports initializing the instance from <code>Awake</code> so maybe it can be used by adding directly it to an object in the scene. However, <code>InitManager</code> is not called in <code>Awake</code> so if you call <code>AutoSingletonManager.Instance</code> after it already awakes then InitManager will never be called.</p>
<p>Another more subtle draw back is it uses an unnecessary comparison <code>if (!Compare&lt;T&gt;(default(T), _instance)) return _instance;</code> in the <code>Instance</code> property, so it's not optimal if you call <code>Instance</code> in a <code>Update</code> loop or something similar.</p>
<p>Surely we can do better than this.</p>
<h3>Secure UnitySingleton</h3>
<p><a href="http://wiki.unity3d.com/index.php/Secure_UnitySingleton">SecureUnitySingleton</a> is the last one of the three singleton implementation in <a href="http://wiki.unity3d.com">unity3d</a>. It has a very clear idea about the usecases of singletons. There are 3 main supported usecases:</p>
<ul>
<li>Exists In Scene: Searches the current scene for an object with the singleton component attached to it.</li>
<li>Loaded From Resources: This type creates an instance of a prefab with the singleton component attached to it from a Resources folder.</li>
<li>Create on New GameObject: This type creates a new GameObject and attaches a new instance of the singleton component to it.</li>
</ul>
<p>There are several issues with approach:</p>
<ul>
<li>Even though the code is quite functional, it still suffers the performance penalty from checking too many things in the <code>Instance</code> property.</li>
<li>Lack of lifecyle methods. Even though it provides a static <code>DeleteInstance</code> method, there's no other methods to execute when the instance is created. You might think that <code>Awake</code> can be used for that purpose, but it not explicit enough that <code>Awake</code> is called immediately after <code>Instance</code> is called. Another possible issue is <code>Awake</code> will not be called when the prefab is disabled, which should never be desirable but can happen due to a mistake from the developers.</li>
</ul>
<p>This is quite good but surely we can do better.</p>
<h2>Discussions</h2>
<p>First of all, we realize that non of the above methods take into account concurrency issue. If we care about concurrency we can do something like this:</p>
<div class="codehilite"><pre><span></span>    <span class="nv">public</span> <span class="nv">class</span> <span class="nv">MySingleton</span> ...
    {
        <span class="nv">static</span> <span class="nv">MySingleton</span> <span class="nv">_instance</span> <span class="o">=</span> <span class="nv">null</span><span class="c1">;</span>
        <span class="nv">static</span> <span class="nv">object</span> <span class="nv">singletonLock</span> <span class="o">=</span> <span class="nv">new</span> <span class="nv">object</span> <span class="ss">()</span><span class="c1">;</span>

        <span class="nv">public</span> <span class="nv">static</span> <span class="nv">MySingleton</span> <span class="nv">Instance</span>
        {
            <span class="nv">get</span> {
                <span class="k">if</span> <span class="ss">(</span><span class="nv">_instance</span> <span class="o">!=</span> <span class="nv">null</span><span class="ss">)</span> {
                    <span class="k">return</span><span class="c1">;</span>
                }

                <span class="nv">lock</span> <span class="ss">(</span><span class="nv">singletonLock</span><span class="ss">)</span> {
                    <span class="k">if</span> <span class="ss">(</span><span class="nv">_instance</span> <span class="o">!=</span> <span class="nv">null</span><span class="ss">)</span> {
                        <span class="k">return</span> <span class="nv">_instance</span><span class="c1">;</span>
                    }

                    <span class="nv">var</span> <span class="nv">singletonGameObject</span> <span class="o">=</span> <span class="nv">new</span> <span class="nv">GameObject</span> <span class="ss">(</span><span class="s2">&quot;</span><span class="s">MySingleton</span><span class="s2">&quot;</span><span class="ss">)</span><span class="c1">;</span>
                    <span class="nv">GameObject</span>.<span class="nv">DontDestroyOnLoad</span> <span class="ss">(</span><span class="nv">singletonGameObject</span><span class="ss">)</span><span class="c1">;</span>
                    <span class="nv">_instance</span> <span class="o">=</span> <span class="nv">singletonGameObject</span>.<span class="nv">AddComponent</span><span class="o">&lt;</span> <span class="nv">MySingleton</span> <span class="o">&gt;</span> <span class="ss">()</span><span class="c1">;</span>

                    ... <span class="nv">other</span> <span class="nv">initialization</span> <span class="nv">code</span>
                }

                <span class="k">return</span> <span class="nv">_instance</span><span class="c1">;</span>
            }
        }
</pre></div>


<p>By using a simple double lock pattern, we seemingly solve the "concurrency problem". The question is: Do we need to?. Why you have the concurrency problem with singleton? It's because you want to <code>lazy load</code> the singleton, i.e. only create it when it is used for the first time. But that's exactly what we want to avoid if we want to achieve smooth gameplay. So what you should do instead is just create the bloody singleton at the beginning and forget about it. Remember, <code>preload</code> is better than <code>lazy load</code>.</p>
<p>Secondly, I've already mentioned the check for null is redundant if we know we only call the singleton after it's been initialized. In the usecases listed by <code>SecureSingleton</code>, we see that the singleton is either created by code or already exists in the scene as a <code>GameObject</code> which is supposed to be configured by designers. In either case, the code to initialize the scene should be a good place for calling the initialization code of the singleton and there's no need for making it sooner.</p>
<p>So what will happen if the <code>Instance</code> property is called before you initialize the singleton? Obviously an exception will be thrown and this is an ideal case for using Unity Assert because you will have a nice message in development mode but you can also turn it off in production build.</p>
<div class="codehilite"><pre><span></span>    <span class="nv">public</span> <span class="nv">class</span> <span class="nv">GameSingleton</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span> : <span class="nv">MyBaseBehaviour</span> <span class="nv">where</span> <span class="nv">T</span> : <span class="nv">GameSingleton</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span>
    {
        ...
        <span class="nv">public</span> <span class="nv">static</span> <span class="nv">T</span> <span class="nv">Instance</span>
        {
            <span class="nv">get</span> {
                <span class="nv">Assert</span>.<span class="nv">IsNotNull</span> <span class="ss">(</span><span class="nv">instance</span><span class="ss">)</span><span class="c1">;</span>
                <span class="k">return</span> <span class="nv">instance</span><span class="c1">;</span>
            }
        }
</pre></div>


<p>Note that <code>MyBaseBehaviour</code> class is a class derived from <code>MonoBehaviour</code> and is customized specifically for our game. For instance, it might have general code for handling <code>Update</code> or <code>OnDestroy</code>.</p>
<p>All that is left now is writing a function <code>CreateInstance</code> for creating the singleton. This function should be called once only at the exact place where you want it. This means we should design it in such a way to discourage it from being called multiple times randomly by some careless developers. Calling <code>CreateInstance</code> twice should throw an exception. This is better than mindlessly guard the function in the name of "defensive programming". It will look something like this:</p>
<div class="codehilite"><pre><span></span>        <span class="nv">public</span> <span class="nv">static</span> <span class="nv">T</span> <span class="nv">CreateInstance</span><span class="ss">()</span>
        {
            <span class="nv">Assert</span>.<span class="nv">IsNull</span> <span class="ss">(</span><span class="nv">instance</span><span class="ss">)</span><span class="c1">;</span>

            <span class="nv">GameObject</span> <span class="nv">go</span> <span class="o">=</span> <span class="nv">new</span> <span class="nv">GameObject</span><span class="ss">(</span><span class="nv">typeof</span><span class="ss">(</span><span class="nv">T</span><span class="ss">)</span>.<span class="nv">Name</span><span class="ss">)</span><span class="c1">;</span>
            <span class="nv">instance</span> <span class="o">=</span> <span class="nv">go</span>.<span class="nv">AddComponent</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span><span class="ss">()</span><span class="c1">;</span>
            <span class="nv">instance</span>.<span class="nv">OnCreated</span><span class="ss">()</span><span class="c1">;</span>
            <span class="nv">DontDestroyOnLoad</span><span class="ss">(</span><span class="nv">go</span><span class="ss">)</span><span class="c1">;</span>

            <span class="k">return</span> <span class="nv">instance</span><span class="c1">;</span>
        }


        <span class="nv">protected</span> <span class="nv">virtual</span> <span class="nv">void</span> <span class="nv">OnCreated</span><span class="ss">()</span>
        {
        }
</pre></div>


<p>Here we have a virtual function <code>OnCreated</code> waiting to be overriden in subclass. To destroy the singleton, we don't have to use fancy static function <code>DeleteInstance</code>, instead we can just get the singleton gameobject and destroy it like this:</p>
<div class="codehilite"><pre><span></span>    <span class="n">GameObject</span><span class="p">.</span><span class="k">Destroy</span> <span class="p">(</span><span class="n">MySingleton</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">gameObject</span><span class="p">);</span>
</pre></div>


<p>When the <code>OnDestroy</code> function is called, we will set <code>instance</code> variable to null then allow subclass to do cleanup themselves. The reason why we don't use <code>DeleteInstance</code> is because we don't want developers who use the API to think there's anything special about destroying the singleton than just destroying the container object.</p>
<p>Finally, we discuss feature <code>destroy if exists in scene</code>. In my opinion, this feature accounts for a very small proportion of our usecases. Most of the time we have a singleton already exists in scene, or in some prefab is because we want to use Unity to store game data. But that's should not be the main way to deal with game data. We'd better use off-unity format to store game data, like text or database. If we need to store linked resources we can use Scriptable Object. The point is to not rely too much on data stored in prefab or scene just because you want designers to change them easily, they can also change text file or database much more easily than firing up Unity. Also, merging prefab is harder than merging text data.</p>
<p>If you really want to use avoid duplicate singleton in scene, we can simply use this piece of code from <code>SecureUnitySingleton</code>:</p>
<div class="codehilite"><pre><span></span>    <span class="nv">protected</span> <span class="nv">virtual</span> <span class="nv">void</span> <span class="nv">Awake</span><span class="ss">()</span>
    {
        <span class="k">if</span> <span class="ss">(</span><span class="nv">InstanceExists</span> <span class="o">&amp;&amp;</span> <span class="nv">instance</span> <span class="o">!=</span> <span class="nv">this</span><span class="ss">)</span>
            <span class="nv">Destroy</span><span class="ss">(</span><span class="nv">gameObject</span><span class="ss">)</span><span class="c1">;</span>
    }
</pre></div>


<h2>Implementation</h2>
<p>After we've considered different aspect of singletons and what our real usecases are, we finalize our own version Unity singleton as follows</p>
<div class="codehilite"><pre><span></span><span class="nv">using</span> <span class="nv">UnityEngine</span><span class="c1">;</span>
<span class="nv">using</span> <span class="nv">System</span><span class="c1">;</span>
<span class="nv">using</span> <span class="nv">UnityEngine</span>.<span class="nv">Assertions</span><span class="c1">;</span>

<span class="nv">public</span> <span class="nv">class</span> <span class="nv">SimpleSingleton</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span> : <span class="nv">BaseMonoBehaviour</span> <span class="nv">where</span> <span class="nv">T</span> : <span class="nv">SimpleSingleton</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span>
{
    <span class="nv">private</span> <span class="nv">static</span> <span class="nv">T</span> <span class="nv">instance</span><span class="c1">;</span>

    <span class="nv">public</span> <span class="nv">static</span> <span class="nv">T</span> <span class="nv">Instance</span> {
        <span class="nv">get</span> {
            <span class="nv">Assert</span>.<span class="nv">IsNotNull</span> <span class="ss">(</span><span class="nv">instance</span>, <span class="s2">&quot;</span><span class="s">Instance is null. Please call CreateInstance first!</span><span class="s2">&quot;</span><span class="ss">)</span><span class="c1">;</span>
            <span class="k">return</span> <span class="nv">instance</span><span class="c1">;</span>
        }
    }

    <span class="nv">public</span> <span class="nv">static</span> <span class="nv">T</span> <span class="nv">CreateInstance</span> <span class="ss">()</span>
    {
        <span class="k">if</span> <span class="ss">(</span><span class="nv">instance</span> <span class="o">!=</span> <span class="nv">null</span><span class="ss">)</span> {
            <span class="nv">Assert</span>.<span class="nv">IsNull</span> <span class="ss">(</span><span class="nv">instance</span>, <span class="s2">&quot;</span><span class="s">Instance is not null. Please call CreateInstance once only</span><span class="s2">&quot;</span><span class="ss">)</span><span class="c1">;</span>
        }

        <span class="nv">GameObject</span> <span class="nv">go</span> <span class="o">=</span> <span class="nv">new</span> <span class="nv">GameObject</span> <span class="ss">(</span><span class="nv">typeof</span><span class="ss">(</span><span class="nv">T</span><span class="ss">)</span>.<span class="nv">Name</span><span class="ss">)</span><span class="c1">;</span>
        <span class="nv">instance</span> <span class="o">=</span> <span class="nv">go</span>.<span class="nv">AddComponent</span><span class="o">&lt;</span><span class="nv">T</span><span class="o">&gt;</span> <span class="ss">()</span><span class="c1">;</span>

        <span class="nv">instance</span>.<span class="nv">OnCreated</span> <span class="ss">()</span><span class="c1">;</span>

        <span class="k">return</span> <span class="nv">instance</span><span class="c1">;</span>
    }

    <span class="nv">protected</span> <span class="nv">virtual</span> <span class="nv">void</span> <span class="nv">OnDestroy</span> <span class="ss">()</span>
    {
        <span class="nv">instance</span> <span class="o">=</span> <span class="nv">null</span><span class="c1">;</span>
    }

    <span class="nv">protected</span> <span class="nv">virtual</span> <span class="nv">void</span> <span class="nv">OnCreated</span> <span class="ss">()</span>
    {
    }

}
</pre></div>


<p>Then remember to call <code>CreateInstance</code> when necessary and in appropriate order.</p>
<p>The code with a sample scene is available on github at <a href="https://github.com/minhhh/unity-singleton">https://github.com/minhhh/unity-singleton</a></p>
<p>Regarding the <code>Has Customized Parameters</code> singletons, there are some implementations of this type using Prefab to set the parameters. This method is not recommended. Instead, we can use ScriptableObject to store the parameter and let the Singleton read from these ScriptableObject. This method will make all the settings centralized in a single location.</p>
<p>TODO: Create SceneSingleton</p>
  </div>
  
<div class="article-tag-list">
<span class="label label-default">Tags</span>
	<a href="https://minhhh.github.io/tag/unity.html"><i class="fa fa-tag"></i>unity</a>&nbsp;
	<a href="https://minhhh.github.io/tag/singleton.html"><i class="fa fa-tag"></i>singleton</a>&nbsp;
</div>  <hr />
  <div class="well well-sm">  <!-- Social media sharing buttons -->

    <!-- Google+ -->
    <div class="g-plus" data-action="share" data-annotation="bubble"></div>
    &nbsp;&nbsp;&nbsp;&nbsp;
    <div class="g-plusone" data-size="medium"></div>&nbsp;

    <!-- Facebook -->
    <div class="fb-like" 
        data-href="https://minhhh.github.io/posts/unity-singleton" 
        data-layout="button_count" 
        data-action="like" data-show-faces="true" 
        data-share="true">
    </div>
    &nbsp;
  </div> <!-- /Social media sharing buttons -->
  <div class="comments">
	<h2>Comments</h2>
	<div id="disqus_thread"></div>
	<script type="text/javascript">
				   (function() {
						var dsq = document.createElement('script');
						dsq.type = 'text/javascript'; dsq.async = true;
						dsq.src = '//minhhh.disqus.com/embed.js';
						(document.getElementsByTagName('head')[0] ||
						 document.getElementsByTagName('body')[0]).appendChild(dsq);
				  })();
	</script>
  </div>
</article>
        </div><!-- /content -->

        <div class="col-md-3 sidebar-nav" id="sidebar">

<div class="row">

<div class="col-xs-6 col-md-12">
<h4><i class="fa fa-comment fa-fw fa-lg"></i> Social</h4>
<ul class="list-unstyled social-links">
    <li><a href="https://twitter.com/utsace" target="_blank">
	  <i class="fa fa-twitter-square fa-fw" title="Twitter"></i>
		Twitter
	</a></li>
    <li><a href="https://www.facebook.com/minh.ha.hanoi" target="_blank">
	  <i class="fa fa-facebook-square fa-fw" title="Facebook"></i>
		Facebook
	</a></li>
    <li><a href="https://github.com/minhhh" target="_blank">
	  <i class="fa fa-github-square fa-fw" title="GitHub"></i>
		GitHub
	</a></li>
</ul>
</div>

<div class="col-xs-6 col-md-12">
<h4><i class="fa fa-folder fa-fw fa-lg"></i> Categories</h4>
<ul class="list-unstyled category-links">
  <li><a href="https://minhhh.github.io/category/blog.html" >
    <i class="fa fa-folder-open fa-fw"></i> Blog</a></li>
  <li><a href="https://minhhh.github.io/category/productivity.html" >
    <i class="fa fa-folder-open fa-fw"></i> Productivity</a></li>
  <li><a href="https://minhhh.github.io/category/programming.html" >
    <i class="fa fa-folder-open fa-fw"></i> Programming</a></li>
  <li><a href="https://minhhh.github.io/category/technology.html" >
    <i class="fa fa-folder-open fa-fw"></i> Technology</a></li>
  <li><a href="https://minhhh.github.io/category/unity.html" >
    <i class="fa fa-folder-open fa-fw"></i> Unity</a></li>
  <li><a href="https://minhhh.github.io/category/web-development.html" >
    <i class="fa fa-folder-open fa-fw"></i> Web Development</a></li>
</ul>
</div>

</div> <!-- /row -->

<h4><i class="fa fa-link fa-fw fa-lg"></i> Links</h4>
<ul class="list-unstyled links-links">
  <li><a href=http://getpelican.com/ >
    <i class="fa fa-fw fa-external-link-square"></i> Pelican</a></li>
  <li><a href=http://python.org/ >
    <i class="fa fa-fw fa-external-link-square"></i> Python.org</a></li>
</ul>

<h4><i class="fa fa-tags fa-fw fa-lg"></i> Tags</h4>
<p class="tag-cloud">
<span class="tag-1">
    <a href="https://minhhh.github.io/tag/unity.html">
        <i class="fa fa-tag fa-fw"></i>unity
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/deconstructed.html">
        <i class="fa fa-tag fa-fw"></i>deconstructed
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/ios.html">
        <i class="fa fa-tag fa-fw"></i>ios
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/blender.html">
        <i class="fa fa-tag fa-fw"></i>blender
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/multiplayer.html">
        <i class="fa fa-tag fa-fw"></i>multiplayer
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/splitalpha.html">
        <i class="fa fa-tag fa-fw"></i>splitalpha
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/github.html">
        <i class="fa fa-tag fa-fw"></i>github
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/optimization.html">
        <i class="fa fa-tag fa-fw"></i>optimization
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/decorator.html">
        <i class="fa fa-tag fa-fw"></i>decorator
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/backend.html">
        <i class="fa fa-tag fa-fw"></i>backend
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/assetbundle.html">
        <i class="fa fa-tag fa-fw"></i>assetbundle
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/uasync.html">
        <i class="fa fa-tag fa-fw"></i>uasync
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/singleton.html">
        <i class="fa fa-tag fa-fw"></i>singleton
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/pool.html">
        <i class="fa fa-tag fa-fw"></i>pool
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/awk.html">
        <i class="fa fa-tag fa-fw"></i>awk
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/otp.html">
        <i class="fa fa-tag fa-fw"></i>otp
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/property.html">
        <i class="fa fa-tag fa-fw"></i>property
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/game.html">
        <i class="fa fa-tag fa-fw"></i>game
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/rebase.html">
        <i class="fa fa-tag fa-fw"></i>rebase
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/nodejs.html">
        <i class="fa fa-tag fa-fw"></i>nodejs
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/bash.html">
        <i class="fa fa-tag fa-fw"></i>bash
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/magic-method.html">
        <i class="fa fa-tag fa-fw"></i>magic method
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/cli.html">
        <i class="fa fa-tag fa-fw"></i>cli
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/network.html">
        <i class="fa fa-tag fa-fw"></i>network
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/coroutine.html">
        <i class="fa fa-tag fa-fw"></i>coroutine
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/dither.html">
        <i class="fa fa-tag fa-fw"></i>dither
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/macos.html">
        <i class="fa fa-tag fa-fw"></i>macos
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/android.html">
        <i class="fa fa-tag fa-fw"></i>android
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/medium.html">
        <i class="fa fa-tag fa-fw"></i>medium
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/socialnetwork.html">
        <i class="fa fa-tag fa-fw"></i>socialnetwork
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/editor.html">
        <i class="fa fa-tag fa-fw"></i>editor
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/c.html">
        <i class="fa fa-tag fa-fw"></i>c#
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/scriptableobject.html">
        <i class="fa fa-tag fa-fw"></i>scriptableobject
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/rx.html">
        <i class="fa fa-tag fa-fw"></i>rx
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/blur.html">
        <i class="fa fa-tag fa-fw"></i>blur
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/gmail.html">
        <i class="fa fa-tag fa-fw"></i>gmail
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/checklist.html">
        <i class="fa fa-tag fa-fw"></i>checklist
    </a>
</span>
<span class="tag-2">
    <a href="https://minhhh.github.io/tag/git.html">
        <i class="fa fa-tag fa-fw"></i>git
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/osx.html">
        <i class="fa fa-tag fa-fw"></i>osx
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/tmux.html">
        <i class="fa fa-tag fa-fw"></i>tmux
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/blog.html">
        <i class="fa fa-tag fa-fw"></i>blog
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/particlesystem.html">
        <i class="fa fa-tag fa-fw"></i>particlesystem
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/nodeenv.html">
        <i class="fa fa-tag fa-fw"></i>nodeenv
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/netcat.html">
        <i class="fa fa-tag fa-fw"></i>netcat
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/memcache.html">
        <i class="fa fa-tag fa-fw"></i>memcache
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/pelican.html">
        <i class="fa fa-tag fa-fw"></i>pelican
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/vim.html">
        <i class="fa fa-tag fa-fw"></i>vim
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/mobile.html">
        <i class="fa fa-tag fa-fw"></i>mobile
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/shell.html">
        <i class="fa fa-tag fa-fw"></i>shell
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/bluetooth.html">
        <i class="fa fa-tag fa-fw"></i>bluetooth
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/python.html">
        <i class="fa fa-tag fa-fw"></i>python
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/prefab.html">
        <i class="fa fa-tag fa-fw"></i>prefab
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/unittest.html">
        <i class="fa fa-tag fa-fw"></i>unittest
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/assert.html">
        <i class="fa fa-tag fa-fw"></i>assert
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/mecanim.html">
        <i class="fa fa-tag fa-fw"></i>mecanim
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/mesh.html">
        <i class="fa fa-tag fa-fw"></i>mesh
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/fsm.html">
        <i class="fa fa-tag fa-fw"></i>fsm
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/mvc.html">
        <i class="fa fa-tag fa-fw"></i>mvc
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/commandline.html">
        <i class="fa fa-tag fa-fw"></i>commandline
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/mac.html">
        <i class="fa fa-tag fa-fw"></i>mac
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/jelly.html">
        <i class="fa fa-tag fa-fw"></i>jelly
    </a>
</span>
<span class="tag-3">
    <a href="https://minhhh.github.io/tag/texture.html">
        <i class="fa fa-tag fa-fw"></i>texture
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/promise.html">
        <i class="fa fa-tag fa-fw"></i>promise
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/webp.html">
        <i class="fa fa-tag fa-fw"></i>webp
    </a>
</span>
<span class="tag-4">
    <a href="https://minhhh.github.io/tag/conda.html">
        <i class="fa fa-tag fa-fw"></i>conda
    </a>
</span>
</p>

<h4><i class="fa fa-rss fa-fw fa-lg"></i> Feeds</h4>
<ul class="list-unstyled feed-links">
    <li><a href="https://minhhh.github.io/feeds/all.atom.xml" 
		   type="application/atom+xml" rel="alternate">
		<i class="fa fa-rss-square fa-fw"></i> Atom Feed</a></li>
</ul>

<hr />

        </div><!--/sidebar -->
      </div><!--/row-->
    </div><!--/.container /#main-container -->

    <footer id="site-footer">
 
      <address id="site-colophon">
        <p class="text-center text-muted">
        Site built using <a href="http://getpelican.com/" target="_blank">Pelican</a>
        &nbsp;&bull;&nbsp; Theme based on
        <a href="http://www.voidynullness.net/page/voidy-bootstrap-pelican-theme/"
           target="_blank">VoidyBootstrap</a> by 
        <a href="http://www.robertiwancz.com/"
           target="_blank">RKI</a>  
        </p>
      </address><!-- /colophon  -->
    </footer>

<!-- DISQUS script for displaying comment count -->
<script type="text/javascript">
    var disqus_shortname = 'minhhh';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

    <!-- javascript -->
   
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>


<!-- Facebook -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script>

<!-- Twitter -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<!-- Google+ -->
<!-- Synchronous 
<script type="text/javascript" src="https://apis.google.com/js/plusone.js"></script>
-->
<!-- Asynchronous -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/platform.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>  </body>
</html>